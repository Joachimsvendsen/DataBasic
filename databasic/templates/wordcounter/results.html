{% extends "tool_base.html" %}
{% from 'macros.html' import hover_tooltip, download_url %}
{% from 'tool_footer.html' import what_next %}

{% block title %}{{ _('Word-Counter results') }}{% endblock %}

{% block custom_css %}
	<link href="{{ url_for('static', filename='css/wordcounter-results.scss.css') }}" rel="stylesheet" type="text/css">
{% endblock %}

{% block nav %}
	{% include 'tool_nav.html' %}
{% endblock %}

{% block body %}
<div class="container-fluid">
	<div class="row">
		<div class="col-xs-12">
			<div class="top-info">
				<h3>{{ title }}</h3>
				<p>{{ _('Here is a picture of the words used most often in your the document. Words used more often are bigger, and ones used less often are smaller. This picture, called a "word cloud", is helpful to get a sense of the most used words in a document.') }}</p>
				{{ what_next_anchor() }}
			</div>
			<div class="word-cloud"></div>
		</div>
	</div>

	<div class="row" id="frequencies">
		<div class="col-sm-4">
			<h2>{{ _('Top Words') }} 
			<a href="/{{ g['current_lang'] }}/wordcounter/results/download/{{ csv_files[0] }}"><span class="glyphicon glyphicon-download" aria-hidden="true"></span></a></h2>
			<table class="table">
				<thead>
					<tr><th>{{ _('Word') }}</th><th>{{ _('Frequency') }}</th></tr>
				</thead>
				<tbody>
					{% for word in results[0]|batch(20)|first%}
					<tr>
						<td>{{ word[0] }}</td>
						<td>{{ word[1] }}</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
		<div class="col-sm-4">
			<h2>{{ _('Bigrams') }} <a href="/{{ g['current_lang'] }}/wordcounter/results/download/{{ csv_files[1] }}"><span class="glyphicon glyphicon-download" aria-hidden="true"></span></a></h2>
			<table class="table">
				<thead>
					<tr><th>{{ _('%(bigram)s', bigram=hover_tooltip('Bigram', 'A bigram is a two word phrase')) }}</th><th>{{ _('Frequency') }}</th></tr>
				</thead>
				<tbody>
					{% for word in results[1]|batch(20)|first %}
					<tr>
						<td>{{ " ".join(word[0]) }}</td>
						<td>{{ word[1] }}</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
		<div class="col-sm-4">
			<h2>{{ _('Trigrams') }} <a href="/{{ g['current_lang'] }}/wordcounter/results/download/{{ csv_files[2] }}"><span class="glyphicon glyphicon-download" aria-hidden="true"></span></a></h2>
			<table class="table">
				<thead>
					<tr><th>{{ _('%(trigram)s', trigram=hover_tooltip('Trigram', 'A trigram is a three word phrase')) }}</th><th>{{ _('Frequency') }}</th></tr>
				</thead>
				<tbody>
					{% for word in results[2]|batch(20)|first %}
					<tr>
						<td>{{ " ".join(word[0]) }}</td>
						<td>{{ word[1] }}</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
</div>
{% endblock %}

{% block custom_footer %}
	{{ what_next("Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec a diam lectus. Sed sit amet ipsum mauris. Maecenas congue ligula ac quam viverra nec consectetur ante hendrerit. Donec et mollis dolor.") }}
{% endblock %}

{% block results_scripts %}
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
	<script type="text/javascript" src="/static/js/lib/d3.layout.cloud.js" charset="utf-8"></script>
	<script type="text/javascript">

		var data = [
			{% for word in results[0] | batch(50) | first %}
				{ text: "{{ word[0]|safe }}", size: {{ word[1]|float }} },
			{% endfor %}
		];

		var maxScore = Math.max.apply(Math, data.map(function(o) {return o.size;}))
		var fontSizeScale = d3.scale.linear()
			.domain([0, maxScore])
			.range([8, 70]); 

		var fill = d3.scale.category20();
		var layout = d3.layout.cloud()
			.size([700, 400])
			.words(data)
			.padding(8)
			.rotate(function () { return 0; })
			.fontSize(function(d) { return fontSizeScale(d.size); })
			.on("end", draw);

		layout.start();

		function draw(words) {
			d3.select('.word-cloud').append('svg')
				.attr('width', layout.size()[0])
				.attr('height', layout.size()[1])
			.append('g')
				.attr('transform', 'translate(' + layout.size()[0] / 2 + ',' + layout.size()[1] / 2 + ')')
			.selectAll('text')
				.data(words)
			.enter().append('text')
				.classed('cloud-text', true)
				.style('font-size', function(d) { return d.size + 'px'; })
				.style('font-family', function (d) { return d.size > 30 ? 'HalisGR-Medium' : 'HalisGR-Book'; })
				.attr('text-anchor', 'middle')
				.attr('transform', function (d) {
					return 'translate(' + [d.x, d.y] + ')rotate(' + d.rotate + ')';
				})
				.text(function (d) { return d.text; });
		}
	</script>
{% endblock %}