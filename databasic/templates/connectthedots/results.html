{% extends 'tool_base.html' %}
{% from 'macros.html' import render_forms, hover_tooltip, shareable with context %}

{% block title %}{{ _('ConnectTheDots: ') }}{{ results['filename'] }}{% endblock %}

{% block custom_css %}
  <link href="{{ url_for('static', filename='css/connectthedots-results.scss.css') }}" rel="stylesheet" type="text/css">
{% endblock %}

{% block results_scripts %}
  <script type="text/javascript">
    var data = JSON.parse({{ results['json'] | tojson | safe }});
    var filename = '{{ results["filename"] }}';
  </script>
  {% assets "js_ctd" %}<script type="text/javascript" src="{{ ASSET_URL }}"></script>{% endassets %}
{% endblock %}

{% block nav %}
  {% include 'tool_header.html' %}
{% endblock %}

{% block body %}
<div class="tool" role="main">
  <div class="container">
    {% if has_multiple_sheets %}
      <h4 class="text-center" role="alert">Warning: The file you uploaded had multiple sheets, but we only used the first sheet.</h4>
    {% endif %}
    <div class="row text-center">
      <div class="col-md-12">
        <h2 id="results-title" role="banner">{{ results['filename'] }} {{ shareable() }}</h2>
      </div>
      <div class="col-md-4 col-md-offset-2">
        <p class="summary">{{ _('%(node_count)s %(nodes)s and %(edge_count)s %(edges)s',
            node_count=results['nodes'],
            edge_count=results['edges'],
            nodes=hover_tooltip(_('nodes'), 'nodes', _('Definition of node.')),
            edges=hover_tooltip(_('edges'), 'edges', _('Definition of edge.'))
          ) }}</p>
      </div>
      <div class="col-md-4">
        <div class="btn-group" role="group">
          <label class="btn-group-label" aria-hidden="true">Export graph:</label>
          <button class="btn btn-default btn-export--png" type="button" aria-label="Export graph as PNG">PNG</button>
          <button class="btn btn-default btn-export--svg" type="button" aria-label="Export graph as SVG">SVG</button>
          <button class="btn btn-default btn-export--gexf" type="button" aria-label="Export graph as GEXF">GEXF</button>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-7">
        <div class="ctd-container">
          <div class="ctd-progress" role="progressbar" aria-hidden="true"></div>
          <div class="ctd-tooltip tooltip top" role="tooltip" aria-hidden="true">
            <div class="tooltip-arrow"></div>
            <div class="tooltip-inner"></div>
          </div>
          <svg class="ctd-graph"></svg>
          <div class="row text-center" role="list" aria-label="Graph metadata">
            <div class="col-sm-4">
              <h4 class="ctd-meta--name" role="listitem">{{ _('%(density_score)s',
                density_score=hover_tooltip(_('density score'), 'density score', _('Definition of density score.'))
                ) }}</h4>
              <h3 class="ctd-meta--value" role="listitem">{{ results['density'] | round(3) }}</h3>
            </div>
            <div class="col-sm-4">
              <h4 class="ctd-meta--name" role="listitem">{{ _('%(clustering_score)s',
                clustering_score=hover_tooltip(_('clustering score'), 'clustering score', _('Definition of clustering score.'))
                ) }}</h4>
              <h3 class="ctd-meta--value" role="listitem">{{ results['clustering'] | round(3) }}</h3>
            </div>
            <div class="col-sm-4">
              <h4 class="ctd-meta--name" role="listitem">{{ _('%(most_central_node)s',
                most_central_node=hover_tooltip(_('most central node'), 'centrality', _('Definition of centrality.'))
                ) }}</h4>
              <h3 class="ctd-meta--value" role="listitem">
                {% set kevin_bacon = results['centrality_scores'][0][0] %}
                {% if kevin_bacon is number and kevin_bacon is equalto kevin_bacon | round %}
                  {{ kevin_bacon | int }}
                {% else %}
                  {{ kevin_bacon }}
                {% endif %}
              </h3>
            </div>
          </div>
          {{ what_next_anchor() }}
        </div>
      </div>
      <div class="col-md-5">
        <table class="ctd-table table table-compact table-striped" aria-label="Top 40 nodes by degree">
          <thead>
            <tr>
              <th data-column="id">
                {{ _('%(node)s',
                node=hover_tooltip(_('Node'), 'node', _('Definition of node.'), 'bottom', 'hover')
                ) }}
              </th>
              <th class="ctd-sort--desc" data-column="degree">
                {{ _('%(degree)s',
                degree=hover_tooltip(_('Degree'), 'degree', _('Definition of degree.'), 'bottom', 'hover')
                ) }}
              </th>
              <th data-column="centrality">
                {{ _('%(centrality)s',
                centrality=hover_tooltip(_('Centrality'), 'centrality', _('Definition of centrality.'), 'bottom', 'hover')
                ) }}
              </th>
            </tr>
          </thead>
        </table>
      </div>
    </div>
  </div>
  <div class="container-fluid">
    <div id="what-next" class="row text-center">
      <div class="col-md-8 col-md-offset-2">
        {{ what_next(_('Cras mattis consectetur purus sit amet fermentum. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor. Donec id elit non mi porta gravida at eget metus. Maecenas faucibus mollis interdum.')) }}
      </div>
    </div>
  </div>
</div>
{% endblock %}