Gettext=function(a){this.domain="messages",this.locale_data=void 0;var b=["domain","locale_data"];if(this.isValidObject(a))for(var c in a)for(var d=0;d<b.length;d++)c==b[d]&&this.isValidObject(a[c])&&(this[c]=a[c]);return this.try_load_lang(),this},Gettext.context_glue="",Gettext._locale_data={},Gettext.prototype.try_load_lang=function(){if("undefined"!=typeof this.locale_data){var a=this.locale_data;if(this.locale_data=void 0,this.parse_locale_data(a),"undefined"==typeof Gettext._locale_data[this.domain])throw new Error("Error: Gettext 'locale_data' does not contain the domain '"+this.domain+"'")}var b=this.get_lang_refs();if("object"==typeof b&&b.length>0)for(var c=0;c<b.length;c++){var d=b[c];if("application/json"==d.type){if(!this.try_load_lang_json(d.href))throw new Error("Error: Gettext 'try_load_lang_json' failed. Unable to exec xmlhttprequest for link ["+d.href+"]")}else{if("application/x-po"!=d.type)throw new Error("TODO: link type ["+d.type+"] found, and support is planned, but not implemented at this time.");if(!this.try_load_lang_po(d.href))throw new Error("Error: Gettext 'try_load_lang_po' failed. Unable to exec xmlhttprequest for link ["+d.href+"]")}}},Gettext.prototype.parse_locale_data=function(a){"undefined"==typeof Gettext._locale_data&&(Gettext._locale_data={});for(var b in a)if(a.hasOwnProperty(b)&&this.isValidObject(a[b])){var c=!1;for(var d in a[b]){c=!0;break}if(c){var e=a[b];""==b&&(b="messages"),this.isValidObject(Gettext._locale_data[b])||(Gettext._locale_data[b]={}),this.isValidObject(Gettext._locale_data[b].head)||(Gettext._locale_data[b].head={}),this.isValidObject(Gettext._locale_data[b].msgs)||(Gettext._locale_data[b].msgs={});for(var f in e)if(""==f){var g=e[f];for(var h in g){var i=h.toLowerCase();Gettext._locale_data[b].head[i]=g[h]}}else Gettext._locale_data[b].msgs[f]=e[f]}}for(var b in Gettext._locale_data)if(this.isValidObject(Gettext._locale_data[b].head["plural-forms"])&&"undefined"==typeof Gettext._locale_data[b].head.plural_func){var j=Gettext._locale_data[b].head["plural-forms"],k=new RegExp("^(\\s*nplurals\\s*=\\s*[0-9]+\\s*;\\s*plural\\s*=\\s*(?:\\s|[-\\?\\|&=!<>+*/%:;a-zA-Z0-9_()])+)","m");if(!k.test(j))throw new Error("Syntax error in language file. Plural-Forms header is invalid ["+j+"]");var l=Gettext._locale_data[b].head["plural-forms"];/;\s*$/.test(l)||(l=l.concat(";"));var m="var plural; var nplurals; "+l+' return { "nplural" : nplurals, "plural" : (plural === true ? 1 : plural ? plural : 0) };';Gettext._locale_data[b].head.plural_func=new Function("n",m)}else"undefined"==typeof Gettext._locale_data[b].head.plural_func&&(Gettext._locale_data[b].head.plural_func=function(a){var b=1!=a?1:0;return{nplural:2,plural:b}})},Gettext.prototype.try_load_lang_po=function(a){var b=this.sjax(a);if(b){var c=this.uri_basename(a),d=this.parse_po(b),e={};return d&&(d[""]||(d[""]={}),d[""].domain||(d[""].domain=c),c=d[""].domain,e[c]=d,this.parse_locale_data(e)),1}},Gettext.prototype.uri_basename=function(a){var b;if(b=a.match(/^(.*\/)?(.*)/)){var c;return(c=b[2].match(/^(.*)\..+$/))?c[1]:b[2]}return""},Gettext.prototype.parse_po=function(a){for(var b={},c={},d="",e=[],f=a.split("\n"),g=0;g<f.length;g++){f[g]=f[g].replace(/(\n|\r)+$/,"");var h;if(/^$/.test(f[g])){if("undefined"!=typeof c.msgid){var i="undefined"!=typeof c.msgctxt&&c.msgctxt.length?c.msgctxt+Gettext.context_glue+c.msgid:c.msgid,j="undefined"!=typeof c.msgid_plural&&c.msgid_plural.length?c.msgid_plural:null,k=[];for(var l in c){var h;(h=l.match(/^msgstr_(\d+)/))&&(k[parseInt(h[1])]=c[l])}k.unshift(j),k.length>1&&(b[i]=k),c={},d=""}}else{if(/^#/.test(f[g]))continue;(h=f[g].match(/^msgctxt\s+(.*)/))?(d="msgctxt",c[d]=this.parse_po_dequote(h[1])):(h=f[g].match(/^msgid\s+(.*)/))?(d="msgid",c[d]=this.parse_po_dequote(h[1])):(h=f[g].match(/^msgid_plural\s+(.*)/))?(d="msgid_plural",c[d]=this.parse_po_dequote(h[1])):(h=f[g].match(/^msgstr\s+(.*)/))?(d="msgstr_0",c[d]=this.parse_po_dequote(h[1])):(h=f[g].match(/^msgstr\[0\]\s+(.*)/))?(d="msgstr_0",c[d]=this.parse_po_dequote(h[1])):(h=f[g].match(/^msgstr\[(\d+)\]\s+(.*)/))?(d="msgstr_"+h[1],c[d]=this.parse_po_dequote(h[2])):/^"/.test(f[g])?c[d]+=this.parse_po_dequote(f[g]):e.push("Strange line ["+g+"] : "+f[g])}}if("undefined"!=typeof c.msgid){var i="undefined"!=typeof c.msgctxt&&c.msgctxt.length?c.msgctxt+Gettext.context_glue+c.msgid:c.msgid,j="undefined"!=typeof c.msgid_plural&&c.msgid_plural.length?c.msgid_plural:null,k=[];for(var l in c){var h;(h=l.match(/^msgstr_(\d+)/))&&(k[parseInt(h[1])]=c[l])}k.unshift(j),k.length>1&&(b[i]=k),c={},d=""}if(b[""]&&b[""][1]){for(var m={},n=b[""][1].split(/\\n/),g=0;g<n.length;g++)if(n.length){var o=n[g].indexOf(":",0);if(-1!=o){var p=n[g].substring(0,o),q=n[g].substring(o+1),r=p.toLowerCase();m[r]&&m[r].length?e.push("SKIPPING DUPLICATE HEADER LINE: "+n[g]):/#-#-#-#-#/.test(r)?e.push("SKIPPING ERROR MARKER IN HEADER: "+n[g]):(q=q.replace(/^\s+/,""),m[r]=q)}else e.push("PROBLEM LINE IN HEADER: "+n[g]),m[n[g]]=""}b[""]=m}else b[""]={};return b},Gettext.prototype.parse_po_dequote=function(a){var b;return(b=a.match(/^"(.*)"/))&&(a=b[1]),a=a.replace(/\\"/g,'"')},Gettext.prototype.try_load_lang_json=function(a){var b=this.sjax(a);if(b){var c=this.JSON(b);return this.parse_locale_data(c),1}},Gettext.prototype.get_lang_refs=function(){for(var a=new Array,b=document.getElementsByTagName("link"),c=0;c<b.length;c++)if("gettext"==b[c].rel&&b[c].href){if("undefined"==typeof b[c].type||""==b[c].type)if(/\.json$/i.test(b[c].href))b[c].type="application/json";else if(/\.js$/i.test(b[c].href))b[c].type="application/json";else if(/\.po$/i.test(b[c].href))b[c].type="application/x-po";else{if(!/\.mo$/i.test(b[c].href))throw new Error("LINK tag with rel=gettext found, but the type and extension are unrecognized.");b[c].type="application/x-mo"}if(b[c].type=b[c].type.toLowerCase(),"application/json"==b[c].type)b[c].type="application/json";else if("text/javascript"==b[c].type)b[c].type="application/json";else if("application/x-po"==b[c].type)b[c].type="application/x-po";else{if("application/x-mo"!=b[c].type)throw new Error("LINK tag with rel=gettext found, but the type attribute ["+b[c].type+"] is unrecognized.");b[c].type="application/x-mo"}a.push(b[c])}return a},Gettext.prototype.textdomain=function(a){return a&&a.length&&(this.domain=a),this.domain},Gettext.prototype.gettext=function(a){var b,c,d,e;return this.dcnpgettext(null,b,a,c,d,e)},Gettext.prototype.dgettext=function(a,b){var c,d,e,f;return this.dcnpgettext(a,c,b,d,e,f)},Gettext.prototype.dcgettext=function(a,b,c){var d,e,f;return this.dcnpgettext(a,d,b,e,f,c)},Gettext.prototype.ngettext=function(a,b,c){var d,e;return this.dcnpgettext(null,d,a,b,c,e)},Gettext.prototype.dngettext=function(a,b,c,d){var e,f;return this.dcnpgettext(a,e,b,c,d,f)},Gettext.prototype.dcngettext=function(a,b,c,d,e){var f;return this.dcnpgettext(a,f,b,c,d,e,e)},Gettext.prototype.pgettext=function(a,b){var c,d,e;return this.dcnpgettext(null,a,b,c,d,e)},Gettext.prototype.dpgettext=function(a,b,c){var d,e,f;return this.dcnpgettext(a,b,c,d,e,f)},Gettext.prototype.dcpgettext=function(a,b,c,d){var e,f;return this.dcnpgettext(a,b,c,e,f,d)},Gettext.prototype.npgettext=function(a,b,c,d){var e;return this.dcnpgettext(null,a,b,c,d,e)},Gettext.prototype.dnpgettext=function(a,b,c,d,e){var f;return this.dcnpgettext(a,b,c,d,e,f)},Gettext.prototype.dcnpgettext=function(a,b,c,d,e,f){if(!this.isValidObject(c))return"";var g=this.isValidObject(d),h=this.isValidObject(b)?b+Gettext.context_glue+c:c,i=this.isValidObject(a)?a:this.isValidObject(this.domain)?this.domain:"messages",k=new Array;if("undefined"!=typeof Gettext._locale_data&&this.isValidObject(Gettext._locale_data[i]))k.push(Gettext._locale_data[i]);else if("undefined"!=typeof Gettext._locale_data)for(var l in Gettext._locale_data)k.push(Gettext._locale_data[l]);var o,m=[],n=!1;if(k.length)for(var p=0;p<k.length;p++){var q=k[p];if(this.isValidObject(q.msgs[h])){for(var r=0;r<q.msgs[h].length;r++)m[r]=q.msgs[h][r];if(m.shift(),o=q,n=!0,m.length>0&&0!=m[0].length)break}}(0==m.length||0==m[0].length)&&(m=[c,d]);var s=m[0];if(g){var t;if(n&&this.isValidObject(o.head.plural_func)){var u=o.head.plural_func(e);u.plural||(u.plural=0),u.nplural||(u.nplural=0),u.nplural<=u.plural&&(u.plural=0),t=u.plural}else t=1!=e?1:0;this.isValidObject(m[t])&&(s=m[t])}return s},Gettext.strargs=function(a,b){null==b||"undefined"==typeof b?b=[]:b.constructor!=Array&&(b=[b]);for(var c="";;){var e,d=a.indexOf("%");if(-1==d){c+=a;break}if(c+=a.substr(0,d),"%%"==a.substr(d,2))c+="%",a=a.substr(d+2);else if(e=a.substr(d).match(/^%(\d+)/)){var f=parseInt(e[1]),g=e[1].length;f>0&&null!=b[f-1]&&"undefined"!=typeof b[f-1]&&(c+=b[f-1]),a=a.substr(d+1+g)}else c+="%",a=a.substr(d+1)}return c},Gettext.prototype.strargs=function(a,b){return Gettext.strargs(a,b)},Gettext.prototype.isArray=function(a){return this.isValidObject(a)&&a.constructor==Array},Gettext.prototype.isValidObject=function(a){return null==a?!1:"undefined"==typeof a?!1:!0},Gettext.prototype.sjax=function(a){var b;if(b=window.XMLHttpRequest?new XMLHttpRequest:-1!=navigator.userAgent.toLowerCase().indexOf("msie 5")?new ActiveXObject("Microsoft.XMLHTTP"):new ActiveXObject("Msxml2.XMLHTTP"),!b)throw new Error("Your browser doesn't do Ajax. Unable to support external language files.");b.open("GET",a,!1);try{b.send(null)}catch(c){return}var d=b.status;if(200==d||0==d)return b.responseText;var e=b.statusText+" (Error "+b.status+")";return b.responseText.length&&(e+="\n"+b.responseText),void alert(e)},Gettext.prototype.JSON=function(data){return eval("("+data+")")};